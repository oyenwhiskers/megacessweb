<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MegaCess Web â€¢ Manage Payment Rate</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/megacessweb/assets/css/style.css">
  <link rel="stylesheet" href="/megacessweb/assets/css/manage-payment-rate.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body data-page="payment-rate">
  <div class="app d-flex">
    <aside class="sidebar p-3" id="sidebar-root"></aside>

    <main class="content flex-grow-1">
      <div class="topbar py-3 px-4 d-flex align-items-center justify-content-between">
        <h1 class="page-title h5 mb-0">Manage Payment Rate</h1>
        <button class="btn btn-outline-light d-lg-none" id="sidebarToggle">
          <i class="bi bi-list"></i>
        </button>
      </div>
      
      <div class="container-fluid p-4">
        <!-- Slider (Control both views)-->
        <div class="type-of-payment-slider text-start mx-3 my-4">
          <div class="btn-group" role="group" aria-label="Type of Payment Rate">
            <input type="radio" class="btn-check" name="rateType" id="salary" autocomplete="off" checked>
            <label class="rate-btn" for="salary">
              <i class="bi bi-cash-stack me-2"></i> Salary Management
            </label>

            <input type="radio" class="btn-check" name="rateType" id="work" autocomplete="off">
            <label class="rate-btn" for="work">
              <i class="bi bi-briefcase me-2"></i> Work-based Rate
            </label>
          </div>
        </div>
        <hr>

        <div class="content-inner flex-grow-1 px-3">
          <!-- Salary Management Section -->
          <div id="salarySection" class="payment-rate-container mx-auto">

            <!-- Radio Button for Selecting Worker/Staff -->
            <div class="employee-selection text-start my-4">
              <div class="type-of-employee-btn" role="group" aria-label="Type of Employee">
              <input type="radio" class="salary-select-employee" name="employeeType" id="worker" autocomplete="off" checked>
              <label class="select-employee-btn" for="worker"><i class="bi bi-person-workspace me-2"></i>Worker</label> 

              <input type="radio" class="salary-select-employee" name="employeeType" id="staff" autocomplete="off">
              <label class="select-employee-btn" for="staff"><i class="bi bi-person-badge me-2"></i>Staff</label> 

              <span class="selection-bg"></span>
              </div>
            </div>

            <!-- Worker Section -->
            <div id="workerSection">
              <div class="search-section my-4">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <form class="row g-3 align-items-center">
                      <div class="col-12">
                        <label for="searchWorker" class="form-label fw-semibold">Search Worker Name:</label>
                        <div class="input-group justify-content-center">
                          <span class="input-group-text bg-success text-white">
                            <i class="bi bi-person-search"></i>
                          </span>
                          <input type="text" id="searchWorker" class="form-control" placeholder="Enter worker name..">
                          <button class="btn btn-outline-danger search-clear-btn" type="button" id="clearSearchWorker" style="display: none;" title="Clear search">
                            <i class="bi bi-x-lg"></i>
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <div id="workerList" class="worker-list my-4">
                <div class="row g-3">
                  <!-- Worker cards injected by JS -->
                </div>
              </div>
            </div>

            <!-- Staff Section -->
            <div id="staffSection" class="d-none">
              <div class="search-section my-4">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <form class="row g-3 align-items-center">
                      <div class="col-12">
                        <label for="searchStaff" class="form-label fw-semibold">Search Staff Name:</label>
                        <div class="input-group justify-content-center">
                          <span class="input-group-text bg-success text-white">
                            <i class="bi bi-person-search"></i>
                          </span>
                          <input type="text" id="searchStaff" class="form-control" placeholder="Enter staff name..">
                          <button class="btn btn-outline-danger search-clear-btn" type="button" id="clearSearchStaff" style="display: none;" title="Clear search">
                            <i class="bi bi-x-lg"></i>
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <div class="filter-section my-4">
                <div class="card shadow-sm">
                  <div class="card-body text-center">
                    <div class="btn-group filter-group" role="group" aria-label="Staff Filter">
                      <input type="radio" class="btn-check" name="staffFilter" id="filterAll" autocomplete="off" checked>
                      <label class="btn btn-outline-success filter-btn" for="filterAll">All</label>

                      <input type="radio" class="btn-check" name="staffFilter" id="filterMandor" autocomplete="off">
                      <label class="btn btn-outline-success filter-btn" for="filterMandor">Mandor</label>

                      <input type="radio" class="btn-check" name="staffFilter" id="filterManager" autocomplete="off">
                      <label class="btn btn-outline-success filter-btn" for="filterManager">Manager</label>

                      <input type="radio" class="btn-check" name="staffFilter" id="filterChecker" autocomplete="off">
                      <label class="btn btn-outline-success filter-btn" for="filterChecker">Checker</label>

                      <input type="radio" class="btn-check" name="staffFilter" id="filterAdmin" autocomplete="off">
                      <label class="btn btn-outline-success filter-btn" for="filterAdmin">Admin</label>
                    </div>
                  </div>
                </div>
              </div>

              <div id="staffList" class="staff-list my-4">
                <div class="row g-3">
                  <!-- Staff cards injected by JS -->
                </div>
              </div>
            </div>
          </div>

          <!-- Work-based Rate Section -->
          <div id="workSection" class="payment-rate-container mx-auto d-none">
            <!-- <div class="add-rate-btn text-end mb-3">
              <a href="/megacessweb/pages/manage-payment-rate-work-based-rate-add-new.html" class="btn btn-success">
                <i class="bi bi-plus-circle me-1"></i> Add new Payment Rate
              </a>
            </div> -->

            <div class="work-based-container d-flex flex-column flex-lg-row gap-3">
              <!-- Left panel: Task List -->
              <div class="task-list card shadow-sm col-12 col-lg-4">
                <div class="card-header bg-success text-white">
                  <h6 class="mb-0"><i class="bi bi-list-task me-2"></i> Task Rate List</h6>
                </div>
                <div class="card-body p-0">
                  <ul id="taskList" class="list-group list-group-flush"></ul>
                </div>
              </div>

              <!-- Right panel: Preview/Editor -->
              <div class="task-editor card shadow-sm col-12 col-lg-8">
                <div class="card-header bg-success text-white">
                  <h6 class="mb-0"><i class="bi bi-pencil-square me-2"></i> Edit Task Details</h6>
                </div>
                <div class="card-body"></div>
              </div>
            </div>
          </div>
        </div> <!-- content-inner -->
      </div> <!-- container-fluid -->
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/megacessweb/assets/js/main.js"></script>
  <script src="/megacessweb/assets/js/get_payment_rate.js"></script>
  <script src="/megacessweb/assets/js/delete_payment_rate.js"></script>
  <script src="/megacessweb/assets/js/salary_get_user.js"></script>
  <script src="/megacessweb/assets/js/salary_get_worker.js"></script>
  <script src="/megacessweb/assets/js/logout.js"></script>

<!-- Final Toggle + URL Sync Script -->
<script>
$(function() {
  function updatePageState(type, employee = null, push = true) {
    if (type === 'work') {
      $('#salarySection').addClass('d-none');
      $('#workSection').removeClass('d-none');
      $('#work').prop('checked', true);
      // Load payment rates when work section is shown
      if (typeof getPaymentRates === 'function') getPaymentRates();
    } else {
      $('#workSection').addClass('d-none');
      $('#salarySection').removeClass('d-none');
      $('#salary').prop('checked', true);
    }

    if (type === 'salary') {
      if (employee === 'staff') {
        $('#staffSection').removeClass('d-none');
        $('#workerSection').addClass('d-none');
        $('#staff').prop('checked', true);
        if(typeof fetchUsers === 'function') fetchUsers(1);
      } else {
        $('#workerSection').removeClass('d-none');
        $('#staffSection').addClass('d-none');
        $('#worker').prop('checked', true);
        if(typeof fetchWorkers === 'function') fetchWorkers(1);
      }
    }

    const url = new URL(window.location);
    url.searchParams.set('type', type);
    if (type === 'salary') url.searchParams.set('employee', employee || 'worker');
    else url.searchParams.delete('employee');

    if (push) history.pushState({ type, employee }, '', url);
    else history.replaceState({ type, employee }, '', url);
  }

  const params = new URLSearchParams(window.location.search);
  const initialType = params.get('type') === 'work' ? 'work' : 'salary';
  const initialEmployee = params.get('employee') === 'staff' ? 'staff' : 'worker';
  updatePageState(initialType, initialEmployee, false);

  // Event Handlers
  $('#salary').on('change', function() {
    if ($(this).is(':checked')) {
      const employee = $('#staff').is(':checked') ? 'staff' : 'worker';
      updatePageState('salary', employee);
    }
  });
  $('#work').on('change', function() {
    if ($(this).is(':checked')) updatePageState('work');
  });
  $('#worker').on('change', function() {
    if ($(this).is(':checked') && $('#salary').is(':checked')) updatePageState('salary', 'worker');
  });
  $('#staff').on('change', function() {
    if ($(this).is(':checked') && $('#salary').is(':checked')) updatePageState('salary', 'staff');
  });

  window.addEventListener('popstate', function() {
    const p = new URLSearchParams(window.location.search);
    const type = p.get('type') === 'work' ? 'work' : 'salary';
    const employee = p.get('employee') === 'staff' ? 'staff' : 'worker';
    updatePageState(type, employee, false);
  });
});
</script>

</body>
</html>
